version: "3"
services:
  vpn:
    image: ghcr.io/bubuntux/nordlynx
    network_mode: bridge
    container_name: nordvpn
    cap_add:
      - NET_ADMIN
    environment:
      - "PRIVATE_KEY=${NORDLYNX_KEY}"
      - "NET_LOCAL=${MAIN_NETWORK}"
      - "TZ=${TIMEZONE}"
      - DNS=8.8.8.8,8.8.4.4
    ports:
      - 8082:8080
    healthcheck:
      test: "curl -ILXGET https://www.google.com"
    restart: always

  rutorrent:
    image: crazymax/rtorrent-rutorrent:latest
    network_mode: service:vpn
    container_name: rutorrent
    depends_on:
      - vpn
    environment:
      - PUID=1000
      - PGID=1000
      - "TZ=${TIMEZONE}"
    volumes:
      - ./rtorrent-rutorrent:/data
      - ./downloads:/downloads
      - /backup/rutorrent:/backup
    healthcheck:
      test: "curl -ILXGET https://www.google.com && curl -ILXGET http://127.0.0.1:8080"
    restart: always

  autoheal:
    image: willfarrell/autoheal
    container_name: autoheal
    environment:
      - AUTOHEAL_CONTAINER_LABEL=all
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    restart: always

  cgp:
    image: pedbarbosa/docker-cgp
    container_name: cgp
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /var/lib/collectd/rrd:/var/lib/collectd/rrd:ro
    ports:
      - 8085:80
    healthcheck:
      test: "curl -ILXGET http://localhost"
    restart: always

  ddclient:
    image: linuxserver/ddclient
    container_name: ddclient
    environment:
      - PUID=1000
      - PGID=1000
      - "TZ=${TIMEZONE}"
    volumes:
      - ./ddclient/ddclient.conf:/config/ddclient.conf
    restart: always

  homeassistant:
    image: homeassistant/home-assistant:latest
    container_name: homeassistant
    depends_on:
      - mariadb
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./homeassistant:/config
    ports:
      - 8123:8123
    healthcheck:
      test: "curl -ILXGET http://localhost:8123"
    restart: always

  jellyfin:
    image: linuxserver/jellyfin
    container_name: jellyfin
    environment:
      - PUID=1000
      - PGID=1000
      - "TZ=${TIMEZONE}"
      - "JELLYFIN_PublishedServerUrl=${JELLYFIN_SERVER}"
    volumes:
      - ./jellyfin:/config
      - "${VIDEO_PATH}/Movies:/data/movies"
      - "${VIDEO_PATH}/TV:/data/tvshows"
    ports:
      - 8096:8096
      - 1900:1900/udp
      - 7359:7359/udp
    devices:
      - /dev/dri:/dev/dri
    restart: always

  mariadb:
    image: linuxserver/mariadb
    container_name: mariadb
    environment:
      - PUID=1000
      - PGID=1000
      - "TZ=${TIMEZONE}"
      - "MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}"
      - "MYSQL_PWD=${MYSQL_ROOT_PASSWORD}"
    volumes:
      - ./mariadb:/config
    ports:
      - 3306:3306
    healthcheck:
      test: ["CMD-SHELL", "mysqladmin ping"]
      timeout: 2s
      retries: 10
    restart: always

  postfix:
    image: pedbarbosa/docker-postfix
    container_name: postfix
    ports:
      - "25:25"
      - "587:587"
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./postfix:/config
      - /var/log/maillog:/var/log/maillog
    restart: always

  projectsend:
    image: lscr.io/linuxserver/projectsend:latest
    container_name: projectsend
    environment:
      - PUID=1000
      - PGID=1000
      - "TZ=${TIMEZONE}"
    volumes:
      - ./projectsend/config:/config
      - ./projectsend/data:/data
    ports:
      - 8083:80
    restart: always

  proxy:
    image: nginx
    container_name: proxy
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./proxy/.htpasswd:/etc/nginx/.htpasswd:ro
      - ./proxy/certs:/etc/nginx/certs:ro
      - ./proxy/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./proxy/index.html:/var/www/html/index.html:ro
    ports:
      - 80:80
      - 443:443
    restart: always
    
  sickchill:
    image: linuxserver/sickchill
    container_name: sickchill
    environment:
      - PUID=1000
      - PGID=1000
      - "TZ=${TIMEZONE}"
    volumes:
      - ./sickchill:/config
      - ./downloads:/downloads
      - "${VIDEO_PATH}:/video"
    ports:
      - 8081:8081
    healthcheck:
      test: "wget http://localhost:8081 --spider -q"
      timeout: 5s
      retries: 10
    restart: always

  smokeping:
    image: linuxserver/smokeping
    container_name: smokeping
    environment:
      - PUID=1000
      - PGID=1000
      - "TZ=${TIMEZONE}"
    volumes:
      - ./smokeping/config:/config
      - ./smokeping/data:/data
    ports:
      - 8098:80
    healthcheck:
      test: "wget http://localhost:80 --spider -q"
    restart: always

  swag:
    image: linuxserver/swag
    container_name: swag
    cap_add:
      - NET_ADMIN
    environment:
      - PUID=1000
      - PGID=1000
      - "TZ=${TIMEZONE}"
      - "URL=${SWAG_DOMAIN}"
      - "SUBDOMAINS=${SWAG_SUBDOMAINS}"
      - VALIDATION=dns
      - DNSPLUGIN=cloudflare
      - PROPAGATION=20
      - "EMAIL=${SWAG_EMAIL}"
    volumes:
      - ./swag:/config
    restart: always

  syncthing:
    image: linuxserver/syncthing
    network_mode: host
    container_name: syncthing
    environment:
      - PUID=1000
      - PGID=1000
      - "TZ=${TIMEZONE}"
    volumes:
      - ./syncthing:/config
      - "${SYNCTHING_PATH}:/targets"
    restart: always

  vaultwarden:
    image: vaultwarden/server:latest
    container_name: vaultwarden
    environment:
      - "ADMIN_TOKEN=${VAULT_TOKEN}"
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./vaultwarden:/data/
    ports:
      - 8084:80
    restart: always

